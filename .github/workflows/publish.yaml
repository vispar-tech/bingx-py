name: Publish to PyPI

on:
  push:
    tags:
      - "v*.*.*"  # –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ —Ç–µ–≥–æ–≤, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ñ–æ—Ä–º–∞—Ç—É vX.Y.Z

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      # –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: üõ†Ô∏è Checkout code
        uses: actions/checkout@v3

      # –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"  # –£–∫–∞–∂–∏—Ç–µ –≤–µ—Ä—Å–∏—é Python, –∫–æ—Ç–æ—Ä—É—é –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ

      # –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Poetry
      - name: üì¶ Install Poetry
        run: |
          pip install poetry

      # –®–∞–≥ 4: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –∏–∑ —Ç–µ–≥–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ pyproject.toml
      - name: üè∑Ô∏è Update version from tag
        run: |
          VERSION=${GITHUB_REF#refs/tags/v}
          poetry version $VERSION

      # –®–∞–≥ 5: –ü—É–±–ª–∏–∫–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ –Ω–∞ PyPI
      - name: üöÄ Publish to PyPI
        run: |
          poetry publish --build --username __token__ --password ${{ secrets.PYPI_API_TOKEN }}
